# Ассистент технической поддержки по информационной безопасности

## Архитектура кратко
| Слой            | Технология | Причина выбора |
|-----------------|------------|----------------|
| Backend         | **FastAPI** (Python 3.11) | лёгкий, async |
| Векторная БД    | **Qdrant** (6333) | ANN-поиск, проста в Docker |
| Объект-хранилище| **MinIO** (9000/9001) | S3 совместимость, self-host |
| LLM-API         | OpenAI GPT-4-семейство | качество ответов |
| OCR / ASR       | EasyOCR, Whisper | оффлайн обработка медиа |
| Frontend        | React + Vite | быстрый SPA |
| CI/CD           | GitHub Actions | автоматические тесты и деплой |

## Подробная логика моделей
| Этап | Модель OpenAI | Что делает |
|------|---------------|------------|
| 1. **Clarify / Query-rewrite** | GPT-4.1 **mini** | Понимает вопрос, при необходимости задаёт уточнение; затем формирует оптимальный поисковый запрос. |
| 2. **Векторный поиск**        | *нет* (используем Qdrant) | Поиск top-20 фрагментов (чанков) по эмбеддингу `text-embedding-3-large`. |
| 3. **LLM-Rerank**             | GPT-4.1 **mini** | Сортирует найденные чанки по релевантности (prompt *rerank.txt*). |
| 4. **Интернет-fallback**      | GPT-4.1 **mini** | Если полнота < 0.4, вызывает browser-tool, добавляет ещё контент. |
| 5. **Финальный ответ**        | GPT-4.1 **large** | Пишет структурированный ответ (prompt *final_answer.txt*). |
| 6. **Self-reflection**        | **GPT-4o (o3)** | Проверяет ответ на полноту/точность, исправляет, если нужно (prompt *self_reflection.txt*). |
| 7. **Мультимодальность**      | GPT-4o **(o3)** | Анализ скриншотов/изображений, выдаёт ответ (prompt *multimodal.txt*). |

## Обработка файлов
* **Документы** → чанки 256 ток. → эмбеддинги → Qdrant  
* **Видео** → ffmpeg scene-detect (0.01) → ключевые кадры ≥ 30 с → Whisper ASR → EasyOCR → Qdrant

## Оценка компонентов
* **Qdrant** выбран как самый лёгкий ANN-движок (RAM 2-4 ГБ). Альтернатива pgvector/PostgreSQL — медленнее и сложнее для мультимодальных векторов.  
* **MinIO** даёт S3-API; можно заменить на локальную папку, но тогда потеряем Object-префиксы и Web-консоль.  
* **Docker Compose** оставляем: быстро стартует, легко переносить.  
* При росте объёма > 1 млн векторов можно мигрировать Qdrant на отдельный сервер с 8 ГБ RAM.

(остальной текст оставить без изменений: разделы Frontend UI, Docker Compose сервисы, GitHub Actions, .env.example.)